!function(){"use strict";var e={n:function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,{a:s}),s},d:function(t,s){for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,s=window.wp.data,a=(window.React,window.wp.components),r=window.wp.url,n=window.wp.apiFetch,o=e.n(n),i=window.wp.editPost,l=e=>{const{posts:s,excerpts:a,dispatchTitle:r,dispatchExcerpts:n}=e;return Array.isArray(s)||Array.isArray(a)?(0,t.createElement)(t.Fragment,null,s&&s.map(((e,s)=>(0,t.createElement)("div",{class:"components__item",onClick:()=>r(e)},`${s+1}) ${e}`))),a&&a.map(((e,s)=>(0,t.createElement)("div",{class:"components__item",onClick:()=>n(e)},`${s+1}) ${e}`)))):""},c=e=>{const{dispatchTitle:s,dispatchExcerpts:r}=e,n=JSON.parse(localStorage.getItem("mopenai_response_get-titles")),o=JSON.parse(localStorage.getItem("mopenai_response_get-excerpts")),[i,c]=(0,t.useState)("history-title");return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.TabPanel,{className:"history-tab-panel",activeClass:"active-tab",onSelect:c,tabs:[{name:"history-titles",title:"History titles",className:"history-tab-one"},{name:"history-excerpts",title:"History excerpts",className:"history-tab-two"}]},(e=>(0,t.createElement)(t.Fragment,null,"history-titles"===e.name&&(0,t.createElement)(l,{posts:n,dispatchTitle:s,dispatchExcerpts:r}),"history-excerpts"===e.name&&(0,t.createElement)(l,{excerpts:o,dispatchTitle:s,dispatchExcerpts:r})))))},p=()=>{var e;const[n,p]=(0,t.useState)(!1),[m,d]=(0,t.useState)({message:""}),[u,g]=(0,t.useState)([]),[h,E]=(0,t.useState)([]),[y,b]=(0,t.useState)(!1),[w,_]=(0,t.useState)(""),[S,v]=(0,t.useState)(""),[x,f]=(0,t.useState)("request"),P=e=>{if(e){const t=(0,s.select)("core/editor").getCurrentPostId();(0,s.dispatch)("core/editor").editPost({title:e,id:t}),d({message:"Title updated",status:"success"});const a=(0,s.select)("core/block-editor").getBlocks().find((e=>"core/post-title"===e.name));a?((0,s.dispatch)("core/block-editor").updateBlockAttributes(a.clientId,{title:e}),(0,s.dispatch)("core/editor").editPost({title:e}),console.log("Title updated",e)):console.log("No title block found.")}else d({message:"Title is empty or null."}),console.log("Title is empty or null.");p(!1)},N=e=>{if(e){const t=(0,s.select)("core/editor").getCurrentPostId();(0,s.dispatch)("core/editor").editPost({excerpt:e,id:t}),d({message:"Excerpt updated",status:"success"})}p(!1)},T=e=>{g([]),v(""),E([]);let t=(0,s.select)("core/block-editor").getBlocks().filter((e=>"core/paragraph"===e.name||"core/heading"===e.name)),a="";t.map((e=>{a+=e.attributes.content}));const n={content:a};a.length?("get-excerpts"===e&&_("Most Relevant Excerpts"),"get-titles"===e&&_("Most Relevant Headings"),p(!0),b(!0),d(!1),((e,t)=>o()({path:(0,r.addQueryArgs)(`/mopen_ai/v1/${e}`,t)}))(e,n).then((t=>{let s=JSON.parse(t);if(s.error&&s.error.message)throw new Error(s.error.message);"get-titles"===e?g(s):E(s),localStorage.setItem(`mopenai_response_${e}`,JSON.stringify(s)),b(!1)})).catch((e=>{d({message:e.message}),p(!1),b(!1)}))):d({message:"You should have at least 1 paragraph to proceed!"})};return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(i.PluginSidebarMoreMenuItem,{target:"mopenai-settings-sidebar"}," Open AI "),(0,t.createElement)(i.PluginSidebar,{name:"mopenai-settings-sidebar",title:"Open Ai",icon:"admin-settings"},(0,t.createElement)("div",{class:"mopen-ai__body"},(0,t.createElement)(a.TabPanel,{className:"my-tab-panel",activeClass:"active-tab",onSelect:f,tabs:[{name:"request",title:"Request",className:"tab-one"},{name:"history",title:"History",className:"tab-two"}]},(e=>(0,t.createElement)(t.Fragment,null,"request"===e.name&&(0,t.createElement)("div",{class:"mopen-ai__buton-group",initialOpen:"request"===x},(0,t.createElement)(a.Button,{isSecondary:!0,onClick:()=>T("get-titles")},"Create titles"),(0,t.createElement)(a.Button,{isPrimary:!0,onClick:()=>T("get-excerpts")},"Create excerpt")),"history"===e.name&&(0,t.createElement)(c,{dispatchTitle:P,dispatchExcerpts:N}))))),m.message&&(0,t.createElement)(a.Notice,{status:null!==(e=m.status)&&void 0!==e?e:"error",isDismissible:!0,onRemove:()=>d(!1)},(0,t.createElement)("p",null,m.message)),n&&(0,t.createElement)(a.Modal,{title:w,onRequestClose:()=>{v(""),d({}),p(!1)}},(0,t.createElement)("div",{class:"components-modal__body"},y&&(0,t.createElement)("div",{class:"components-modal__loader"},(0,t.createElement)(a.Spinner,null)),S&&(0,t.createElement)("div",{class:"components-modal__item"},S),(0,t.createElement)(l,{posts:u,excerpts:h,dispatchTitle:P,dispatchExcerpts:N})))))};const m=()=>{const{registerPlugin:e}=wp.plugins,{getEditedPostAttribute:a}=(0,s.select)("core/editor");return(0,t.useEffect)((()=>{"post"===a("type")&&e("mopen-plugin-sidebar",{render:p})}),[a("type")]),null};wp.domReady((()=>{wp.plugins.registerPlugin("mopen-plugin",{render:m})}))}();