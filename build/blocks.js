(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.components,o=window.wp.data,r=window.wp.url,a=window.wp.apiFetch;var n=e.n(a);const i=window.wp.editPost,l=()=>{var e;const[a,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)({message:""}),[p,m]=(0,t.useState)([]),[u,g]=(0,t.useState)([]),[w,v]=(0,t.useState)(!1),[E,b]=(0,t.useState)(""),[h,_]=(0,t.useState)(""),P=e=>{m([]),_(""),g([]);let t=(0,o.select)("core/block-editor").getBlocks().filter((e=>"core/paragraph"===e.name||"core/heading"===e.name)),s="";t.map((e=>{s+=e.attributes.content}));const a={content:s};s.length?("get-excerpts"===e&&b("Most Relevant Excerpts"),"get-titles"===e&&b("Most Relevant Headings"),l(!0),v(!0),d(!1),((e,t)=>n()({path:(0,r.addQueryArgs)(`/mopen_ai/v1/${e}`,t)}))(e,a).then((t=>{let s=JSON.parse(t);s.error&&s.error.message?_(s.error.message):"get-titles"===e?m(s):g(s),v(!1)})).catch((e=>{d({message:e.message}),l(!1),v(!1)}))):d({message:"You should have at least 1 paragraph to proceed!"})};return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(i.PluginSidebarMoreMenuItem,{target:"mopenai-settings-sidebar"},"Open AI"),(0,t.createElement)(i.PluginSidebar,{name:"mopenai-settings-sidebar",title:"Open Ai",icon:"admin-settings"},(0,t.createElement)("div",{class:"mopen-ai__body"},(0,t.createElement)("div",{class:"mopen-ai__buton-group"},(0,t.createElement)(s.Button,{isSecondary:!0,onClick:()=>P("get-titles")},"Create titles"),(0,t.createElement)(s.Button,{isPrimary:!0,onClick:()=>P("get-excerpts")},"Create excerpt"))),c.message&&(0,t.createElement)(s.Notice,{status:null!==(e=c.status)&&void 0!==e?e:"error",isDismissible:!0,onRemove:()=>d(!1)},(0,t.createElement)("p",null,c.message)),a&&(0,t.createElement)(s.Modal,{title:E,onRequestClose:()=>{m([]),g([]),_(""),d({}),l(!1)}},(0,t.createElement)("div",{class:"components-modal__body"},w&&(0,t.createElement)("div",{class:"components-modal__loader"},(0,t.createElement)(s.Spinner,null)),h&&(0,t.createElement)("div",{class:"components-modal__item"},h),p&&p.map(((e,s)=>(0,t.createElement)("div",{class:"components-modal__item",onClick:()=>(e=>{if(e){const t=(0,o.select)("core/editor").getCurrentPostId();(0,o.dispatch)("core/editor").editPost({title:e,id:t}),(0,o.dispatch)("core/editor").savePost(),d({message:"Title updated:",status:"success"});const s=(0,o.select)("core/block-editor").getBlocks().find((e=>"core/post-title"===e.name));s?((0,o.dispatch)("core/block-editor").updateBlockAttributes(s.clientId,{title:e}),(0,o.dispatch)("core/editor").editPost({title:e}),console.log("Title updated",e)):console.log("No title block found.")}else d({message:"Title is empty or null."}),console.log("Title is empty or null.");l(!1)})(e)},`${s+1}) ${e}`))),u&&u.map(((e,s)=>(0,t.createElement)("div",{class:"components-modal__item",onClick:()=>(e=>{if(e){const t=(0,o.select)("core/editor").getCurrentPostId();(0,o.dispatch)("core/editor").editPost({excerpt:e,id:t}),(0,o.dispatch)("core/editor").savePost(),d({message:"Excerpt updated",status:"success"})}l(!1)})(e)},`${s+1}) ${e}`)))))))},c=()=>{const{registerPlugin:e}=wp.plugins,{getEditedPostAttribute:s}=(0,o.select)("core/editor");return(0,t.useEffect)((()=>{"post"===s("type")&&e("mopen-plugin-sidebar",{render:l})}),[s("type")]),null};wp.domReady((()=>{wp.plugins.registerPlugin("mopen-plugin",{render:c})}))})();